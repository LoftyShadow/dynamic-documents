# 系统工作流程图

```
┌─────────────────────────────────────────────────────────────┐
│                    VitePress 动态侧边栏系统                    │
│                      工作流程示意图                            │
└─────────────────────────────────────────────────────────────┘

                    ┌──────────────────┐
                    │   C:\Work\md     │
                    │  (源文档目录)     │
                    │  📁 *.md 文件    │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │  Chokidar 监控   │
                    │   (watch-docs)   │
                    │  👁️ 实时监控     │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │   检测文件变化    │
                    │  ➕ 新增文件     │
                    │  ✏️ 修改文件     │
                    │  ❌ 删除文件     │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │   防抖处理       │
                    │   ⏱️ 延迟 1 秒   │
                    └────────┬─────────┘
                             │
                ┌────────────┴────────────┐
                │                         │
                ▼                         ▼
       ┌─────────────────┐      ┌─────────────────┐
       │  同步文档文件    │      │   提取标题      │
       │  docs/ 目录     │      │   # Title       │
       │  📄 复制 .md    │      │   📝 解析内容   │
       └────────┬────────┘      └────────┬────────┘
                │                         │
                └────────────┬────────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │  生成侧边栏配置   │
                    │  sidebar.ts      │
                    │  ⚙️ 自动生成     │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │  VitePress 配置  │
                    │  config.mts      │
                    │  📋 导入配置     │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │   热更新触发     │
                    │   🔄 HMR        │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │  浏览器自动刷新   │
                    │  🌐 实时展示     │
                    │  ✨ 新侧边栏     │
                    └──────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        关键特性                              │
├─────────────────────────────────────────────────────────────┤
│  ⚡ 实时监控 - 文件变化立即检测                              │
│  🎯 智能提取 - 自动提取 Markdown 标题                        │
│  🌳 层级结构 - 保持目录层级关系                              │
│  🔄 自动同步 - 文档自动复制到 docs/                          │
│  ⏱️ 防抖处理 - 避免频繁触发(1秒延迟)                        │
│  🔥 热更新 - VitePress 自动刷新页面                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      文件结构映射                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  C:\Work\md/                    →    侧边栏配置              │
│  ├── 前端/                           ├── 前端               │
│  │   ├── Vue.md (# Vue 3 入门)      │   ├── Vue 3 入门     │
│  │   └── React.md (# React 基础)    │   └── React 基础     │
│  └── 后端/                           └── 后端               │
│      └── Node.md (# Node.js 教程)        └── Node.js 教程   │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      核心组件说明                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  📁 scripts/generate-sidebar.js                             │
│     - 扫描目录结构                                           │
│     - 提取 Markdown 标题                                     │
│     - 生成侧边栏配置                                         │
│     - 同步文档文件                                           │
│                                                              │
│  👁️ scripts/watch-docs.js                                   │
│     - 启动文件监控                                           │
│     - 处理文件变化事件                                       │
│     - 防抖处理                                               │
│     - 触发重新生成                                           │
│                                                              │
│  ⚙️ .vitepress/config.mts                                   │
│     - VitePress 主配置                                       │
│     - 导入自动生成的侧边栏                                   │
│     - 配置导航和搜索                                         │
│                                                              │
│  📋 .vitepress/config/sidebar.ts                            │
│     - 自动生成的侧边栏配置                                   │
│     - 包含时间戳                                             │
│     - 不要手动修改                                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      使用场景示例                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  场景 1: 新增文档                                            │
│  ─────────────────                                          │
│  1. 在 C:\Work\md 创建 新文档.md                            │
│  2. 监控系统检测到新文件                                     │
│  3. 同步文件到 docs/                                         │
│  4. 提取标题并更新侧边栏                                     │
│  5. 浏览器自动刷新显示新文档                                 │
│                                                              │
│  场景 2: 修改标题                                            │
│  ─────────────────                                          │
│  1. 修改 C:\Work\md\某文档.md 的 # 标题                     │
│  2. 保存文件                                                 │
│  3. 监控系统检测到文件变化                                   │
│  4. 重新提取标题并更新侧边栏                                 │
│  5. 浏览器自动刷新显示新标题                                 │
│                                                              │
│  场景 3: 删除文档                                            │
│  ─────────────────                                          │
│  1. 删除 C:\Work\md 中的某个文件                            │
│  2. 监控系统检测到文件删除                                   │
│  3. 从 docs/ 删除对应文件                                    │
│  4. 从侧边栏配置中移除该项                                   │
│  5. 浏览器自动刷新更新侧边栏                                 │
│                                                              │
│  场景 4: 重组目录                                            │
│  ─────────────────                                          │
│  1. 在 C:\Work\md 中移动文件或创建新文件夹                  │
│  2. 监控系统检测到结构变化                                   │
│  3. 同步新的目录结构到 docs/                                 │
│  4. 按新结构重新生成侧边栏                                   │
│  5. 浏览器自动刷新显示新结构                                 │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      性能优化                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  🚀 防抖处理                                                 │
│     - 文件变化后等待 1 秒再处理                              │
│     - 避免频繁触发重新生成                                   │
│     - 减少 CPU 和 I/O 开销                                   │
│                                                              │
│  📦 增量更新                                                 │
│     - 只同步变化的文件                                       │
│     - 保持其他文件不变                                       │
│     - 提高同步效率                                           │
│                                                              │
│  🎯 智能缓存                                                 │
│     - VitePress 内置缓存机制                                 │
│     - 只重新构建变化的部分                                   │
│     - 快速热更新                                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 时序图

```
用户          监控器          生成器          VitePress        浏览器
 │              │              │               │               │
 │ 编辑文档     │              │               │               │
 ├─────────────>│              │               │               │
 │              │              │               │               │
 │              │ 检测变化     │               │               │
 │              ├─────────────>│               │               │
 │              │              │               │               │
 │              │              │ 同步文件      │               │
 │              │              ├──────────┐    │               │
 │              │              │          │    │               │
 │              │              │<─────────┘    │               │
 │              │              │               │               │
 │              │              │ 提取标题      │               │
 │              │              ├──────────┐    │               │
 │              │              │          │    │               │
 │              │              │<─────────┘    │               │
 │              │              │               │               │
 │              │              │ 生成配置      │               │
 │              │              ├──────────────>│               │
 │              │              │               │               │
 │              │              │               │ 检测配置变化  │
 │              │              │               ├──────────────>│
 │              │              │               │               │
 │              │              │               │ 自动刷新      │
 │              │              │               │<──────────────┤
 │              │              │               │               │
 │              │              │               │ 显示新侧边栏  │
 │<─────────────────────────────────────────────────────────────┤
 │              │              │               │               │
```

## 数据流图

```
┌──────────────┐
│ Markdown 文件 │
│  (源数据)    │
└──────┬───────┘
       │
       │ 读取
       ▼
┌──────────────┐
│  文件内容    │
│  (原始文本)  │
└──────┬───────┘
       │
       │ 解析
       ▼
┌──────────────┐
│  文档标题    │
│  (提取结果)  │
└──────┬───────┘
       │
       │ 组合
       ▼
┌──────────────┐
│  目录结构    │
│  (层级数据)  │
└──────┬───────┘
       │
       │ 转换
       ▼
┌──────────────┐
│  侧边栏配置  │
│  (JSON 格式) │
└──────┬───────┘
       │
       │ 导出
       ▼
┌──────────────┐
│  TypeScript  │
│  (配置文件)  │
└──────┬───────┘
       │
       │ 导入
       ▼
┌──────────────┐
│  VitePress   │
│  (渲染引擎)  │
└──────┬───────┘
       │
       │ 渲染
       ▼
┌──────────────┐
│  HTML 页面   │
│  (最终展示)  │
└──────────────┘
```
